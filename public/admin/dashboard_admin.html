<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel Administrativo - CoelhoLog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: #F3F6FB;
      display: flex;
    }

    /* SIDEBAR */
    .sidebar {
      width: 220px;
      background: #062647;
      color: white;
      height: 100vh;
      padding-top: 20px;
      position: fixed;
    }

    .sidebar a {
      display: block;
      padding: 14px 20px;
      color: #e3e3e3;
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
    }

    .sidebar a:hover {
      background: #0a3a63;
      color: white;
    }

    .sidebar i {
      margin-right: 10px;
    }

    /* TOPBAR */
    .topbar {
      position: fixed;
      left: 220px;
      right: 0;
      top: 0;
      height: 70px;
      background: #062647;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 30px;
    }

    .topbar img {
      height: 42px;
    }

    .logout-btn {
      background: #FFC300;
      border: none;
      padding: 12px 22px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
    }

    /* CONTEÚDO */
    .content {
      margin-left: 220px;
      margin-top: 90px;
      padding: 20px 40px;
    }

    h2 {
      color: #062647;
      font-size: 26px;
      margin-bottom: 25px;
    }

    /* CARDS */
    .cards {
      display: flex;
      gap: 20px;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      width: 23%;
    }

    .card small {
      color: #555;
    }

    .card h3 {
      margin-top: 8px;
      color: #062647;
      font-size: 22px;
    }

    /* TABELA */
    .table-box {
      background: white;
      margin-top: 30px;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    th {
      background: #EAEFF3;
      padding: 12px;
      color: #062647;
      font-weight: 600;
    }

    td {
      padding: 12px;
      border-bottom: 1px solid #eee;
      color: #062647;
      font-weight: 500;
    }
  </style>
</head>

<body>

  <!-- SIDEBAR -->
  <?php include "sidebar_admin.html"; ?>

  <!-- TOPBAR -->
  <div class="topbar">
      <img src="/img/logo.png" alt="CoelhoLog">
      <button class="logout-btn" onclick="logout()">Logout</button>
  </div>

  <!-- CONTEÚDO -->
  <div class="content">
      <h2>Painel Administrativo</h2>

      <div class="cards">
          <div class="card">
              <small>Recebíveis Pendentes</small>
              <h3 id="pendentes">R$ 0,00</h3>
          </div>
          <div class="card">
              <small>Recebíveis Pagos</small>
              <h3 id="pagos">R$ 0,00</h3>
          </div>
          <div class="card">
              <small>Empréstimos Pendentes</small>
              <h3 id="empPendentes">0</h3>
          </div>
          <div class="card">
              <small>Empréstimos Aprovados</small>
              <h3 id="empAprovados">0</h3>
          </div>
      </div>

      <div class="table-box">
          <h3>Últimos Recebíveis</h3>
          <table>
              <thead>
                  <tr>
                      <th>ID</th>
                      <th>Usuário</th>
                      <th>Valor</th>
                      <th>Status</th>
                  </tr>
              </thead>
              <tbody id="listaRecebiveis"></tbody>
          </table>
      </div>
  </div>

<script>
/* PROTEÇÃO ADMIN */
(function(){
    const u = JSON.parse(localStorage.getItem("user"));
    if(!u || u.role !== "admin"){
        window.location.href="../index.html";
    }
})();

/* LOGOUT */
function logout(){
    localStorage.clear();
    window.location.href="../index.html";
}

/* DASHBOARD */
async function carregarDashboard(){
  const r1 = await fetch("/api/recebiveis");
  const rec = await r1.json();

  let pend = 0, pagos = 0;

  rec.forEach(r=>{
    if(r.status==="Pendente") pend += parseFloat(r.valor);
    if(r.status==="Pago") pagos += parseFloat(r.valor);
  });

  document.getElementById("pendentes").textContent = "R$ "+ pend.toLocaleString("pt-BR",{minimumFractionDigits:2});
  document.getElementById("pagos").textContent = "R$ "+ pagos.toLocaleString("pt-BR",{minimumFractionDigits:2});

  const tbody = document.getElementById("listaRecebiveis");
  tbody.innerHTML="";

  rec.slice(0,5).forEach(r=>{
    tbody.innerHTML += `
      <tr>
        <td>${r.id}</td>
        <td>${r.nome}</td>
        <td>R$ ${parseFloat(r.valor).toLocaleString("pt-BR",{minimumFractionDigits:2})}</td>
        <td>${r.status}</td>
      </tr>
    `;
  });

  const r2 = await fetch("/api/emprestimos");
  const emp = await r2.json();

  document.getElementById("empPendentes").textContent = emp.filter(e=>e.status==="Pendente").length;
  document.getElementById("empAprovados").textContent = emp.filter(e=>e.status==="Aprovado").length;
}

carregarDashboard();
</script>

</body>
</html>
