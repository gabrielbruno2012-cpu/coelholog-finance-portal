<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body style="background:#04254d;">

<!-- üîê Prote√ß√£o -->
<script>
const uStr = localStorage.getItem("usuario");
let u = null;
try { u = uStr ? JSON.parse(uStr) : null; } catch(e){ u = null; }

if (!u || (u.role !== "financeiro" && u.role !== "admin")) {
  window.location.href = "/";
}
</script>

<!-- üîµ SIDEBAR -->
<div id="sidebar"></div>

<!-- üîµ MAIN -->
<div class="main" style="margin-left:240px; padding:20px;">

  <!-- üîµ TOPBAR -->
  <div style="width:100%; padding:15px 20px; background:#002147; display:flex; justify-content:space-between; align-items:center; border-radius:8px; margin-bottom:25px;">
      <img src="/img/logo.png" style="height:42px;">
      <button class="btn" onclick="localStorage.clear(); location='/'" style="background:#ffcc00; color:#000;">Logout</button>
  </div>

  <h1 style="color:white;">Criar Colaborador</h1>

  <div class="card" style="
      margin-top:20px; 
      padding:25px; 
      background:white; 
      border-radius:12px; 
      max-width:580px;
    ">

      <div class="form-group">
        <label>Nome*</label>
        <input id="nome" class="input" type="text" placeholder="Digite o nome completo">
      </div>

      <div class="form-group">
        <label>Email*</label>
        <input id="email" class="input" type="email" placeholder="email@exemplo.com">
      </div>

      <div class="form-group">
        <label>Senha*</label>
        <input id="senha" class="input" type="password" placeholder="Digite uma senha">
      </div>

      <div class="form-group">
        <label>Telefone</label>
        <input id="telefone" class="input" type="text" placeholder="(00) 00000-0000">
      </div>

      <div class="form-group">
        <label>CNPJ</label>
        <input id="cnpj" class="input" type="text" placeholder="00.000.000/0000-00">
      </div>

      <div class="form-group">
        <label>Tipo de Usu√°rio</label>
        <select id="role" class="input">
          <option value="colaborador">Colaborador</option>
          <option value="prestador">Prestador</option>
        </select>
      </div>

      <button class="btn" onclick="criar()" 
        style="margin-top:15px; background:#002147;">
        Criar
      </button>

      <p id="msg" style="margin-top:15px; font-weight:bold;"></p>

  </div>
</div>

<!-- SIDEBAR LOAD -->
<script>
fetch("/admin/sidebar_admin.html")
  .then(r => r.text())
  .then(h => sidebar.innerHTML = h);

// Fun√ß√£o de criar colaborador (SEM ALTERA√á√ïES)
async function criar() {
  let nome = document.getElementById("nome").value.trim();
  let email = document.getElementById("email").value.trim();
  let senha = document.getElementById("senha").value.trim();
  let telefone = document.getElementById("telefone").value.trim();
  let cnpj = document.getElementById("cnpj").value.trim();
  let role = document.getElementById("role").value;

  if (!nome || !email || !senha) {
    msg.innerText = "Preencha os campos obrigat√≥rios!";
    msg.style.color = "red";
    return;
  }

  const dados = { nome, email, senha, role, cnpj, telefone };

  const res = await fetch("/api/usuarios", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(dados)
  });

  if (res.ok) {
    msg.innerText = "Colaborador criado com sucesso!";
    msg.style.color = "lightgreen";

    // Limpa inputs corretamente
    document.getElementById("nome").value = "";
    document.getElementById("email").value = "";
    document.getElementById("senha").value = "";
    document.getElementById("telefone").value = "";
    document.getElementById("cnpj").value = "";

  } else {
    msg.innerText = "Erro ao criar colaborador!";
    msg.style.color = "red";
  }
}
</script>

<style>
.form-group {
  margin-bottom: 15px;
}
.form-group label {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
}
.input {
  width: 100%;
  padding: 10px;
  border-radius: 6px;
  border: 1px solid #ccc;
}
</style>

</body>
</html>
